# ZhiQing 系统部署说明

## 演示地址
- **演示系统**: http://172.22.182.54
- **说明**: 这是系统的演示环境，用于展示功能

## 部署说明
部署脚本需要在本地运行，用于将项目部署到您自己的服务器上。

## ⚠️ 重要配置说明

在运行部署脚本之前，请先修改脚本中的服务器信息：

1. **修改 `deploy/full-deploy.sh` 中的服务器配置**：
```bash
# 服务器信息 - 请根据实际情况修改
SERVER_IP="您的服务器IP地址"
SERVER_USER="您的服务器用户名"
SERVER_PASS="您的服务器密码"
SERVER_PORT="您的服务器SSH端口"
```

2. **修改 `deploy/server-setup.sh` 中的数据库配置**（如果使用手动部署）：
```bash
# 设置MySQL root密码
mysql -e "ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY '您的数据库密码';"
```

## 🔧 配置检查清单

在运行部署脚本前，请确认：

- [ ] 已修改 `deploy/full-deploy.sh` 中的服务器信息
- [ ] 已修改 `deploy/server-setup.sh` 中的数据库密码
- [ ] 服务器已开放SSH端口（默认22）
- [ ] 服务器已开放HTTP端口（80）和API端口（8000）
- [ ] 本地已安装SSH客户端和SCP工具

## 部署方式

### 方式一：自动部署（推荐）

1. **在本地执行完整部署脚本**
```bash
# 给脚本添加执行权限
chmod +x deploy/full-deploy.sh

# 执行部署
./deploy/full-deploy.sh
```

这个脚本会自动：
- 连接到您指定的服务器
- 安装MySQL、Python、Node.js、nginx等环境
- 上传项目文件
- 创建数据库和表
- 部署后端和前端
- 配置nginx和服务

**注意**: 使用前需要修改脚本中的服务器信息（IP地址、用户名、密码、端口）

### 方式二：手动部署

1. **连接到您的服务器**
```bash
ssh -p <端口> <用户名>@<服务器IP>
```

2. **上传项目文件**
```bash
# 在本地执行
scp -P <端口> -r . <用户名>@<服务器IP>:/path/to/project/ZhiQing
```

3. **在服务器上执行安装脚本**
```bash
# 给脚本添加执行权限
chmod +x deploy/server-setup.sh

# 执行安装
./deploy/server-setup.sh
```

## 脚本说明

- **`full-deploy.sh`**: 完整部署脚本，适用于新服务器部署
- **`server-setup.sh`**: 服务器端安装脚本，适用于手动部署
- **`nginx-frontend.conf`**: nginx配置文件模板
- **`部署说明.md`**: 详细的部署说明文档

## 系统架构

- **前端**: Vue.js + Element UI (端口80)
- **后端**: Django + Django REST Framework (端口8000)
- **数据库**: MySQL (端口3306)
- **Web服务器**: Nginx (反向代理)

## 访问地址

部署完成后，您可以通过以下地址访问系统：

- **前端**: http://<您的服务器IP>
- **后端API**: http://<您的服务器IP>:8000
- **管理后台**: http://<您的服务器IP>/admin

## 默认账户

- **超级用户**: admin / admin123
- **数据库**: 根据您的配置设置

## 服务管理

```bash
# 启动后端服务
systemctl start zhiqing

# 停止后端服务
systemctl stop zhiqing

# 重启后端服务
systemctl restart zhiqing

# 查看服务状态
systemctl status zhiqing

# 查看服务日志
journalctl -u zhiqing -f

# 重启nginx
systemctl restart nginx

# 重启MySQL
systemctl restart mysql
```

## 常见问题

### 1. 端口被占用
```bash
# 查看端口占用
netstat -tlnp | grep :80
netstat -tlnp | grep :8000

# 杀死占用进程
kill -9 <进程ID>
```

### 2. 数据库连接失败
```bash
# 检查MySQL状态
systemctl status mysql

# 重启MySQL
systemctl restart mysql

# 检查数据库
mysql -uroot -pxxJCss@2025rk -e "SHOW DATABASES;"
```

### 3. 前端无法访问
```bash
# 检查nginx配置
nginx -t

# 检查nginx状态
systemctl status nginx

# 查看nginx错误日志
tail -f /var/log/nginx/error.log
```

### 4. 后端服务无法启动
```bash
# 检查Python环境
source /root/project/ZhiQing/venv/bin/activate
python --version

# 检查依赖
pip list

# 查看详细错误日志
journalctl -u zhiqing -n 50
```

## 防火墙配置

确保服务器防火墙开放了必要的端口：

```bash
# Ubuntu/Debian
ufw allow 80
ufw allow 8000
ufw allow 22

# CentOS/RHEL
firewall-cmd --permanent --add-port=80/tcp
firewall-cmd --permanent --add-port=8000/tcp
firewall-cmd --permanent --add-port=22/tcp
firewall-cmd --reload
```

## 备份和恢复

### 数据库备份
```bash
# 备份数据库
mysqldump -uroot -pxxJCss@2025rk zhiqing_db > backup_$(date +%Y%m%d_%H%M%S).sql

# 恢复数据库
mysql -uroot -pxxJCss@2025rk zhiqing_db < backup_file.sql
```

### 项目文件备份
```bash
# 备份项目文件
tar -czf zhiqing_backup_$(date +%Y%m%d_%H%M%S).tar.gz /root/project/ZhiQing

# 恢复项目文件
tar -xzf backup_file.tar.gz -C /
```

## 性能优化建议

1. **数据库优化**
   - 配置MySQL的innodb_buffer_pool_size
   - 启用查询缓存
   - 定期优化表

2. **Nginx优化**
   - 启用gzip压缩
   - 配置静态文件缓存
   - 调整worker进程数

3. **Django优化**
   - 启用DEBUG=False
   - 配置静态文件收集
   - 使用生产级WSGI服务器

## 监控和维护

1. **日志监控**
   - 应用日志: `/root/project/ZhiQing/logs/`
   - Nginx日志: `/var/log/nginx/`
   - 系统日志: `journalctl`

2. **性能监控**
   - 使用htop监控系统资源
   - 监控MySQL性能
   - 监控应用响应时间

3. **定期维护**
   - 清理日志文件
   - 更新系统包
   - 备份重要数据




